# jwt_epl_dll_wechat
## jwt.e 源码文件
## Jwt.ec 易语言模块
##  jwt.dll 动态链接库
### 三张截图说明了公开的使用方法
### 源码作者Ym_gg(修改) 黎明（主承）
### QQ1195557458(Ym_gg)
### 直接使用此源码内容需要遵守GPL协议
### 以下为源码主要内容
### 完整源码请下载Jwt.zip
1 .版本 2
2
3 .程序集 程序集1
4
5 .子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
6
7 ' 源码作者Ym_gg(修改) 黎明（主承）
8 ' QQ1195557458(Ym_gg)
9 ' 直接使用此源码内容需要遵守GPL协议
10 _临时子程序 () ' 在初始化代码执行完毕后调用测试代码
11 返回 (0) ' 可以根据您的需要返回任意数值
12
13 .子程序 _临时子程序
14 .局部变量 token, 文本型
15 .局部变量 post, 字节集
16 .局部变量 post_text, 文本型
17 .局部变量 EncodingAESKey, 文本型
18
19 ' token ＝ “”
20 ' EncodingAESKey ＝ “”
21
22 ' post ＝ 网页_访问 (“https://openai.weixin.qq.com/openapi/message/” ＋ toke
23 ' post_text ＝ 编码_utf8到gb2312 (到文本 (post))
24
25 ' 输出调试文本 (post_text)
26
27 .子程序 jwt, 文本型, 公开, 基于HMACSHA256 URLBASE64
28 .参数 payload, 文本型, , 请传入json文本msg username
29 .参数 key, 文本型, , EncodingAESKey
30 .局部变量 json, 类_json
31 .局部变量 i, 整数型
32 .局部变量 前两部分, 文本型
33 .局部变量 结果, 文本型
34
35
36 json.解析 (payload)
37 .如果真 (json.属性是否存在 (“jti”) ＝ 假)
38 json.置属性 (“jti”, “5de35dec-9104-47aa-b04d-4fd723d00e7a”) ' jti暂无加
39 .如果真结束
40 .如果真 (json.属性是否存在 (“iat”) ＝ 假)
41 json.置属性数值 (“iat”, 到长整数 (时间_取现行时间戳 (真)))
42 .如果真结束
43 .如果真 (json.属性是否存在 (“exp”) ＝ 假)
44 json.置属性数值 (“exp”, 到长整数 (时间_取现行时间戳 (真)) ＋ 3600)
45 .如果真结束
46 前两部分 ＝ URLbase64_字节集 (到字节集 (#header)) ＋ “.” ＋ URLbase64_字节集 (编
47 json.清除 ()
48 结果 ＝ 前两部分 ＋ “.” ＋ URLbase64_字节集 (字节集_十六进制到字节集 (HmacSHA256
49 输出调试文本 (结果)
50 返回 (结果)
51
52
53 .子程序 URLbase64_字节集, 文本型
54 .参数 预编码文本, 字节集
55
56 返回 (文本_替换 (编码_BASE64编码 (预编码文本), , , , “=”, “”, “+”, “-”, “/”, “
57
58
59 .子程序 URLbase64, 文本型, 公开
60 .参数 预编码文本, 文本型
61
62 返回 (文本_替换 (编码_BASE64编码 (到字节集 (预编码文本)), , , , “=”, “”, “+”, “
63
64
65
66 .子程序 HmacSHA256, 文本型, 公开, https://www.eyuyan.la/post/1954.html
67 .参数 加密文本, 文本型
68 .参数 密钥, 文本型
69 .局部变量 脚本对象, 对象
70 .局部变量 局部文本, 文本型
71
72 CoInitialize (0)
73 脚本对象.创建 (“ScriptControl”, )
74 脚本对象.写属性 (“Language”, “JScript”)
75 脚本对象.数值方法 (“ExecuteStatement”, #sha256)
76 局部文本 ＝ 脚本对象.文本方法 (“Run”, “HMAC”, 加密文本, 密钥)
77 CoUninitialize () ' 返回之前使用 必须释放掉对象才可用
78 返回 (局部文本)
